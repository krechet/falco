module.exports = {
    'setNewUpdate': function(con, model) {
        con.base.Model.update = function(conditions, update, options, callback) {
            model.findOne(conditions, function(err, doc) {
                if (err) {
                    return callback(err);
                }
                if (!doc) {
                    return callback(new Error('Not exists.'));
                }
                for (var ope in update) {
                    switch (ope) {
                        case '$set':
                            for (var key in update['$set']) {
                                doc[key] = update['$set'][key];
                            }
                            // in save() validation run
                            doc.save(function(err) {
                                callback(err);
                            });
                            break;
                        case '$push':
                            for (var key in update['$push']) {
                                doc[key].push(update['$push'][key]);
                            }
                            // in save() validation run
                            doc.save(function(err) {
                                callback(err);
                            });
                            break;
                    }
                }
            });
        };
        return con;
    }
};